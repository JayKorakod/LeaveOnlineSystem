@model List<LeaveSystemOnline.LEAVETYPE>

@{
    ViewBag.Title = "List";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var m = Model.FirstOrDefault();
}

<div class="bg-white">
    <div class="container">
        <ol class="breadcrumb breadcrumb-alt">
            <li class="breadcrumb-item"><a href="@Url.Action("Index","Home")">Home</a></li>
            <li class="breadcrumb-item">ประเภทการลา</li>
        </ol>
    </div>
</div>
<br />
<div class="container container-fixed-lg">
    <div class="card card-default">
        <div class="tools">
        </div>
        <div class="card-body">
            <div class="form-group">
                <h3>ประเภทการลา</h3>
            </div>
            <br />
            <button type="button" onclick="Add_model()" class="btn btn-lg btn-primary pull-right" style="width:100px">เพิ่ม</button>
            <br />
            <div style="overflow:auto">
                <div class="table-responsive">
                    <table class="table table-hover table-responsive-block" id="tableWithSearch">
                        <thead>
                            <tr>
                                <th class="text-center" style="width: 100px" scope="col">ลำดับ</th>
                                <th class="text-center" scope="col">ประเภทการลา</th>
                                <th class="text-center" scope="col">จำนวนวัน</th>
                                <th class="text-center" scope="col">รายละเอียด</th>
                                <th scope="col" class="text-center"></th>
                            </tr>
                        </thead>
                        <tbody>
                            @{ int idx = 1;}
                            @foreach (var item in Model)
                            {
                                <tr>
                                    <td class="text-center" scope="row">@item.id</td>
                                    <td class="text-center">
                                        @item.type
                                    </td>
                                    <td class="text-center">
                                        @item.numOfLeave
                                    </td>
                                    <td class="text-center">
                                        @item.description
                                    </td>
                                    <td class="text-center">
                                        <button type="button" class="btn btn-lg btn-primary" style="width:100px" onclick="Update_modal('@item.id', '@item.type', '@item.numOfLeave', '@item.description')">แก้ไข</button>
                                    </td>
                                </tr>
                                idx++;
                            }
                        <tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade stick-up" id="myModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header clearfix text-left">
                <button aria-label="" type="button" class="close" data-dismiss="modal" aria-hidden="true">
                    <i class="pg-icon">close</i>
                </button>
                <h5><span class="semi-bold">ประเภทลางาน</span></h5>
            </div>
            <div class="modal-body">
                <form role="form" id="formModelData">
                    <div class="form-group-attached">
                        <div class="row">
                            <div class="col-md-12">
                                    <label>type</label>
                                    <input type="email" class="form-control" id="txtType">
                            </div>
                        </div>
                        <br />
                        <div class="row">
                            <div class="col-md-12">
                                    <label>จำนวนวัน</label>
                                    <input type="text" class="form-control" id="txtNum">
                            </div>
                        </div>
                        <br />
                        <div class="row">
                            <div class="col-md-12">
                                <label>รายละเอียด</label>
                                <textarea type="text" class="form-control" id="txtDes" rows="4"></textarea>
                            </div>
                        </div>
                    </div>
                </form>
                <br />
                <div class="modal-footer">
                    <input id="hdd-id" hidden />
                    <button type="button" aria-label="" class="btn btn-primary pull-right" onclick="Save_Type()" id="btn-save" style="width:100px">Save</button>
                    <button type="button" aria-label="" class="btn btn-primary pull-right" onclick="Update_Type()" id="btn-update" style="width:100px">Update</button>
                </div>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
<!-- END MODAL STICK UP  -->

@section Scripts
{
    <script type="text/javascript">

        $(document).ready(function () {
            Validate_tb();
            
        });

        function Update_modal(id, type, num, des) {

            $('#hdd-id').val(id);
            $('#txtType').val(type);
            $('#txtNum').val(num);
            $('#txtDes').val(des);

            $('#myModal').modal('show');

            Check_txtType();
            Check_txtNum();
            Check_txtDes();

            $('#btn-save').hide();
            $('#btn-update').show();
        }

        function Add_model() {

            $('#myModal').modal('show');

            Check_txtType();
            Check_txtNum();
            Check_txtDes();

            $('#btn-update').hide();
            $('#btn-save').show();
        }

        function Save() {

            var model = new Object();

            model.type = $('#txtType').val();
            model.numOfLeave = $('#txtNum').val();
            model.description = $('#txtDes').val();
            $.ajax({
                type: "post",
                url: "@Url.Action("Insert", "LeaveType")",
                data: JSON.stringify(model),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {
                    Alert_Success();
                    location.reload(true);
                    $("#myModal").modal('hide').on('hidden.bs.modal', functionThatEndsUpDestroyingTheDOM);
                },
                error: function () {
                    Alert_Warning();
                    $("#myModal").modal('hide').on('hidden.bs.modal', functionThatEndsUpDestroyingTheDOM);
                }
            })
        }

        function Update() {

            var model = new Object();

            model.id = $('#hdd-id').val();
            model.type = $('#txtType').val();
            model.numOfLeave = $('#txtNum').val();
            model.description = $('#txtDes').val();
            $.ajax({
                type: "post",
                url: "@Url.Action("Update", "LeaveType")",
                data: JSON.stringify(model),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {
                    Alert_Success();
                    location.reload(true);
                    $("#myModal").modal('hide').on('hidden.bs.modal', functionThatEndsUpDestroyingTheDOM);
                },
                error: function () {
                    Alert_Warning();
                    $("#myModal").modal('hide').on('hidden.bs.modal', functionThatEndsUpDestroyingTheDOM);
                }
            })
        }

        function Check_txtType() {
            if ($('#txtType').val() != '') {
                $('#txtType').removeClass('form-control is-invalid').addClass('form-control is-valid');
            }
            else {
                $('#txtType').removeClass('form-control is-valid').addClass('form-control is-invalid');
            }
        }

        function Check_txtNum() {
            if ($('#txtNum').val() != '') {
                $('#txtNum').removeClass('form-control is-invalid').addClass('form-control is-valid');
            }
            else {
                $('#txtNum').removeClass('form-control is-valid').addClass('form-control is-invalid');
            }
        }

        function Check_txtDes() {
            if ($('#txtDes').val() != '') {
                $('#txtDes').removeClass('form-control is-invalid').addClass('form-control is-valid');
            }
            else {
                $('#txtDes').removeClass('form-control is-valid').addClass('form-control is-invalid');
            }
        }

        function Validate_tb() {
            $("#txtType").change(function () {
                Check_txtType();

            });
            $("#txtNum").change(function () {
                Check_txtNum();

            });
            $("#txtDes").change(function () {
                Check_txtDes();

            });
        }

        function Save_Type() {
            if ($('#txtType').val() == '' || $('#txtNum').val() == '' || $('#txtDes').val() == '') {

                Check_txtType();
                Check_txtNum();
                Check_txtDes();

                Alert_Warning();
            } else {
                Swal.fire({
                    title: 'Are you sure?',
                    text: "You won't be able to revert this!",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Yes, Save it!'
                }).then((result) => {
                    if (result.isConfirmed) {
                        Save();
                    }
                })
            }
        }

        function Update_Type() {
            if ($('#txtType').val() == '' || $('#txtNum').val() == '' || $('#txtDes').val() == '') {

                Check_txtType();
                Check_txtNum();
                Check_txtDes();

                Alert_Warning();
            } else {
                Update();
            }
        }

        function Alert_Success() {
            Swal.fire({
                icon: 'success',
                title: 'บันทึกสำเร็จ',
                showConfirmButton: false,
                timer: 3000
            })
        }

        function Alert_Warning() {
            Swal.fire({
                icon: 'error',
                title: 'ผิดพลาด',
                text: 'กรุณาตรวจสอบข้อมูลที่กรอก',
            })
        }

        $('[data-dismiss=modal]').on('click', function (e) {

            var $t = $(this),
                target = $t[0].href || $t.data("target") || $t.parents('.modal') || [];

            //$('#Reason-dropdown').val('').trigger('change');

            $(target)
                .find("input,textarea", "select")
                .val('')
                .end()
                .find("input[type=checkbox], input[type=radio]")
                .prop("checked", "")
                .end();
        })

        $('#myModal').on('hidden.bs.modal', function (e) {
            $(this)
                .find("input,textarea,select")
                .val('')
                .end()
                .find("input[type=checkbox], input[type=radio]")
                .prop("checked", "")
                .end();
        })
    </script>
}